(function(e,t,n,r){"use strict";var i=function(t){this.options={itemSelector:".item",size:250,gap:.5,autoRedraw:true,hideIncompleteRow:false,scrollbarWidth:0,minDiamondsPerRow:2,eventPrefix:"diamonds:",itemWrap:e('<div class="diamond-box-wrap"><div class="diamond-box"><div class="diamond-box-inner"></div></div></div>'),rowWrap:e('<div class="diamond-row-wrap"></div>'),rowUpperWrap:e('<div class="diamond-row-upper"></div>'),rowLowerWrap:e('<div class="diamond-row-lower"></div>'),diamondWrap:e('<div class="diamonds"></div>'),overrideCss:".diamonds-{{guid}} .diamond-box-wrap { width: {{size}}px; height: {{size}}px; } .diamonds-{{guid}} .diamond-box { border-width: {{gap}}px }",debugEnabled:false,debugEvent:function(e,t){console.debug("Event: "+e,t)},debugMethod:function(e,t){console.debug("Method: "+e,t)}};this.wrapElement=t.wrapElement;if(this._triggerEvent("beforeInit"))return;this.setOptions(t,false);this.itemElements=e(this.options.itemSelector,this.wrapElement);this.guid=this._createGuid();this.styleElement=this._createOverrideCss();this.draw();this.startAutoRedraw();this._triggerEvent("afterInit")};i.prototype._triggerEvent=function(t,n){if(this.options.debugEnabled)this.options.debugEvent(t,n);var r=e.Event(this.options.eventPrefix+t);this.wrapElement.trigger(r,n);return r.isDefaultPrevented()};i.prototype._createGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})};i.prototype.destroy=function(){if(this._triggerEvent("beforeDestroy"))return;this._removeOverrideCss();this.stopAutoRedraw();this._emptyElement(this.wrapElement);this.wrapElement.append(this.itemElements);this.wrapElement.removeData("diamonds");this._triggerEvent("afterDestroy")};i.prototype._createOverrideCss=function(){var t=this.options.overrideCss;var n={size:this.options.size,gap:this.options.gap,guid:this.guid};for(var r in n){if(n.hasOwnProperty(r)){t=t.replace(new RegExp("{{"+r+"}}","g"),n[r])}}var i=e('<style type="text/css"></style>');i.html(t);e("head").append(i);return i};i.prototype._removeOverrideCss=function(){if(this.styleElement)this.styleElement.remove()};i.prototype._updateOverrideCss=function(){this._removeOverrideCss();this._createOverrideCss()};i.prototype.stopAutoRedraw=function(){if(this._triggerEvent("beforeStopAutoRedraw"))return;t.clearInterval(this.redrawer);this._triggerEvent("afterStopAutoRedraw")};i.prototype.startAutoRedraw=function(){t.clearInterval(this.redrawer);var e=this.wrapElement.width();if(this.options.autoRedraw){if(this._triggerEvent("beforeStartAutoRedraw"))return;this.redrawer=t.setInterval(function(){var t=this.wrapElement.width();if(t!==e){if(this._triggerEvent("onAutoResize",{before:e,current:t}))return;e=t;this.draw()}}.bind(this),50);this._triggerEvent("afterStartAutoRedraw")}};i.prototype.setOptions=function(t,n){n=n===r?true:n;if(t!==null&&typeof t==="object"){if(this._triggerEvent("beforeSetOptions",t))return;if(this.options.autoRedraw&&!t.autoRedraw){this.stopAutoRedraw()}else if(!this.options.autoRedraw&&t.autoRedraw){this.startAutoRedraw()}e.extend(true,this.options,t);if(n){this._updateOverrideCss();this.draw()}this._triggerEvent("afterSetOptions",t)}};i.prototype._getScrollbarWidth=function(){if(e.isNumeric(this.options.scrollbarWidth)&&this.options.scrollbarWidth>=0){return this.options.scrollbarWidth}var t=e('<div style="width: 100%; height:200px;">test</div>'),n=e('<div style="width:200px;height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(t),r=t[0],i=n[0];e("body").append(i);var s=r.offsetWidth;n.css("overflow","scroll");var o=i.clientWidth;n.remove();return this.scrollbarWidth=s-o};i.prototype._emptyElement=function(t){e("*",t).detach()};i.prototype._groupIntoRows=function(e,t,n){t=Math.max(this.options.minDiamondsPerRow,0+t);var r=new Array;for(var i=0;i<e.length;i++){var s=e[i];var o=r.length%2===0?t-1:t;if(!r.hasOwnProperty(r.length-1)||r[r.length-1].length==o){r.push(new Array)}r[r.length-1].push(s)}if(n){if(r.hasOwnProperty(r.length-1)&&r[r.length-1].length<r.length%2===0?t-1:t){r.pop()}}return r};i.prototype._renderHtml=function(t){var n=this.options.diamondWrap.clone();n.addClass("diamonds-"+this.guid);for(var r=0;r<t.length;r+=2){var i=this.options.rowWrap.clone();var s=this.options.rowUpperWrap.clone();var o=this.options.rowLowerWrap.clone();i.append(s).append(o);n.append(i);for(var u=0;u<t[r].length;u++){s.append(t[r][u]);e(t[r][u]).wrap(this.options.itemWrap)}if(!t.hasOwnProperty(r+1))break;for(var u=0;u<t[r+1].length;u++){o.append(t[r+1][u]);e(t[r+1][u]).wrap(this.options.itemWrap)}}n.css("min-width",this.options.minDiamondsPerRow*this.options.size);return n};i.prototype.draw=function(){if(this._triggerEvent("beforeDraw"))return;this._emptyElement(this.wrapElement);var e=this.options.wrapElement.width()-this._getScrollbarWidth();var t=this._groupIntoRows(this.itemElements,Math.floor(e/this.options.size),this.options.hideIncompleteRow);var n=this._renderHtml(t);this.wrapElement.append(n);this._triggerEvent("afterDraw")};e.fn.diamonds=function(t){if(t===r||e.isPlainObject(t)){t=t||{};t.wrapElement=this;this.data("diamonds",new i(t));return this}var n=this.data("diamonds");if(n==null)throw new Error("Diamonds not initialized on this element.");if(i.prototype.hasOwnProperty(t)){var s=Array.prototype.slice.call(arguments);s.shift();if(n.options.debugEnabled)n.options.debugMethod(t,s);var o=i.prototype[t].apply(n,s);return o===r?this:o}}})(window.hasOwnProperty("Zepto")?window.Zepto:window.jQuery,window,document)